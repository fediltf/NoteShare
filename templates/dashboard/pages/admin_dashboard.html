{% extends 'dashboard/layouts/base.html' %}
{% load static file_extension info_value %}
{% block extrastyle %}
    <style>
        .dot-separator {
            height: 2px;
            width: 2px;
            background: #000;
            border-radius: 50%;
        }

        .actions span {
            cursor: pointer;
        }

        .modal {
            z-index: 99999 !important;
        }

        #imgViewer::-webkit-scrollbar {
            -webkit-appearance: none;
            height: 10px;
        }

        #imgViewer img {
            max-width: 100%;
        }

        #imgViewer::-webkit-scrollbar-thumb {
            border-radius: 5px;
            background-color: rgba(0, 0, 0, .5);
            box-shadow: 0 0 1px rgba(255, 255, 255, .5);
        }
    </style>


{% endblock extrastyle %}
{% block content %}
    <div class="container-fluid py-4 px-5">
        {#        <div class="row">#}
        {#            <div class="col-12">#}
        {#                <div class="card card-background card-background-after-none align-items-start mt-4 mb-5">#}
        {#                    <div class="full-background"#}
        {#                         style="background-image: url('{% static 'assets/img/header-blue-purple.jpg' %}')"></div>#}
        {#                    <div class="card-body text-start p-4 w-100">#}
        {#                        <h3 class="text-white mb-2">Collect your benefits ðŸ”¥</h3>#}
        {#                        <p class="mb-4 font-weight-semibold">#}
        {#                            Check all the advantages and choose the best.#}
        {#                        </p>#}
        {#                        <button type="button"#}
        {#                                class="btn btn-outline-white btn-blur btn-icon d-flex align-items-center mb-0">#}
        {#              <span class="btn-inner--icon">#}
        {#                <svg width="14" height="14" viewBox="0 0 14 14" xmlns="http://www.w3.org/2000/svg" fill="currentColor"#}
        {#                     class="d-block me-2">#}
        {#                  <path fill-rule="evenodd" clip-rule="evenodd"#}
        {#                        d="M7 14C10.866 14 14 10.866 14 7C14 3.13401 10.866 0 7 0C3.13401 0 0 3.13401 0 7C0 10.866 3.13401 14 7 14ZM6.61036 4.52196C6.34186 4.34296 5.99664 4.32627 5.71212 4.47854C5.42761 4.63081 5.25 4.92731 5.25 5.25V8.75C5.25 9.0727 5.42761 9.36924 5.71212 9.52149C5.99664 9.67374 6.34186 9.65703 6.61036 9.47809L9.23536 7.72809C9.47879 7.56577 9.625 7.2926 9.625 7C9.625 6.70744 9.47879 6.43424 9.23536 6.27196L6.61036 4.52196Z"/>#}
        {#                </svg>#}
        {#              </span>#}
        {#                            <span class="btn-inner--text">Watch more</span>#}
        {#                        </button>#}
        {#                        <img src="{% static 'assets/img/3d-cube.png' %}" alt="3d-cube"#}
        {#                             class="position-absolute top-0 end-1 w-25 max-width-200 mt-n6 d-sm-block d-none"/>#}
        {#                    </div>#}
        {#                </div>#}
        {#            </div>#}
        {#        </div>#}
        {#    Members List  #}
        <div class="row">
            <div class="col-12">
                <div class="card border shadow-xs mb-4">
                    <div class="card-header border-bottom pb-0">
                        <div class="d-sm-flex align-items-center">
                            <div>
                                <h6 class="font-weight-semibold text-lg mb-0">Members list</h6>
                                <p class="text-sm">See information about all members</p>
                            </div>
                            <div class="ms-auto d-flex">
                                <button type="button" class="btn btn-sm btn-white me-2">
                                    View all
                                </button>
                                <button type="button"
                                        class="btn btn-sm btn-dark btn-icon d-flex align-items-center me-2">
                  <span class="btn-inner--icon">
                    <svg width="16" height="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
                         fill="currentColor" class="d-block me-2">
                      <path d="M6.25 6.375a4.125 4.125 0 118.25 0 4.125 4.125 0 01-8.25 0zM3.25 19.125a7.125 7.125 0 0114.25 0v.003l-.001.119a.75.75 0 01-.363.63 13.067 13.067 0 01-6.761 1.873c-2.472 0-4.786-.684-6.76-1.873a.75.75 0 01-.364-.63l-.001-.122zM19.75 7.5a.75.75 0 00-1.5 0v2.25H16a.75.75 0 000 1.5h2.25v2.25a.75.75 0 001.5 0v-2.25H22a.75.75 0 000-1.5h-2.25V7.5z"/>
                    </svg>
                  </span>
                                    <a type="button" class="btn-inner--text" href="{% url 'account:register' %}"
                                       style="color: white; text-decoration: none;">Add member</a>
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="card-body px-0 py-0">
                        {#                        <div class="border-bottom py-3 px-3 d-sm-flex align-items-center">#}
                        {#                            <div class="btn-group" role="group" aria-label="Basic radio toggle button group">#}
                        {#                                <input type="radio" class="btn-check" name="btnradiotable" id="btnradiotable1"#}
                        {#                                       autocomplete="off" checked>#}
                        {#                                <label class="btn btn-white px-3 mb-0" for="btnradiotable1">All</label>#}
                        {#                                <input type="radio" class="btn-check" name="btnradiotable" id="btnradiotable2"#}
                        {#                                       autocomplete="off">#}
                        {#                                <label class="btn btn-white px-3 mb-0" for="btnradiotable2">Monitored</label>#}
                        {#                                <input type="radio" class="btn-check" name="btnradiotable" id="btnradiotable3"#}
                        {#                                       autocomplete="off">#}
                        {#                                <label class="btn btn-white px-3 mb-0" for="btnradiotable3">Unmonitored</label>#}
                        {#                            </div>#}
                        {#                            <div class="input-group w-sm-25 ms-auto">#}
                        {#                <span class="input-group-text text-body">#}
                        {#                  <svg xmlns="http://www.w3.org/2000/svg" width="16px" height="16px" fill="none" viewBox="0 0 24 24"#}
                        {#                       stroke-width="1.5" stroke="currentColor">#}
                        {#                    <path stroke-linecap="round" stroke-linejoin="round"#}
                        {#                          d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z"></path>#}
                        {#                  </svg>#}
                        {#                </span>#}
                        {#                                <input type="text" class="form-control" placeholder="Search">#}
                        {#                            </div>#}
                        {#                        </div>#}
                        <div class="table-responsive p-0">
                            <table class="table align-items-center mb-0">
                                <thead class="bg-gray-100">
                                <tr>
                                    <th class="text-secondary text-xs font-weight-semibold opacity-7">Member</th>
                                    <th class="text-secondary text-xs font-weight-semibold opacity-7 ps-2">School</th>
                                    <th class="text-center text-secondary text-xs font-weight-semibold opacity-7">
                                        Balance
                                    </th>
                                    <th class="text-center text-secondary text-xs font-weight-semibold opacity-7">
                                        Status
                                    </th>
                                    <th class="text-center text-secondary text-xs font-weight-semibold opacity-7">
                                        Date Joined
                                    </th>
                                    <th class="text-secondary opacity-7"></th>
                                </tr>
                                </thead>
                                <tbody>
                                {% for student in students %}
                                    {% if not student.user.is_superuser %}
                                        <tr>
                                            <td>
                                                <div class="d-flex px-2 py-1">
                                                    <div class="d-flex align-items-center">
                                                        <img src="{% static 'assets/img/team-3.jpg' %}"
                                                             class="avatar avatar-sm rounded-circle me-2" alt="user2">
                                                    </div>
                                                    <div class="d-flex flex-column justify-content-center ms-1">
                                                        <h6 class="mb-0 text-sm font-weight-semibold">{{ student }}</h6>
                                                        <p class="text-sm text-secondary mb-0">{{ student.user.email }}</p>
                                                    </div>
                                                </div>
                                            </td>
                                            <td>
                                                <p class="text-sm text-dark font-weight-semibold mb-0">{{ student.school }}</p>
                                            </td>
                                            <td class="align-middle text-center text-sm">
                                                <span class="text-xs">
                                                    {{ student.points_field }}
                                                </span>
                                            </td>
                                            <td class="align-middle text-center text-sm">
                                                {% if student.user.is_active %}
                                                    <span class="badge badge-sm border border-success text-success bg-success">Active</span>
                                                {% else %}
                                                    <span class="badge badge-sm border border-danger text-danger bg-danger">Suspended</span>
                                                {% endif %}
                                            </td>
                                            <td class="align-middle text-center">
                                                <span class="text-secondary text-sm font-weight-normal">{{ student.date_joined|date:"F j, Y" }}</span>
                                            </td>

                                            <td class="align-middle">
                                            <span type="button" data-bs-toggle="modal"
                                                  data-bs-target="#delete-profile-{{ student.user.id }}">
                                                <i title="Suspend User Profile" class="fa fa-solid fa-trash"
                                                   style="color:#64748B"></i> </span>
                                            </td>
                                        </tr>
                                        <!-- Delete Profile Modal -->
                                        <div class="modal fade" id="delete-profile-{{ student.user.id }}" tabindex="-1"
                                             aria-labelledby="exampleModalLabel" aria-hidden="true">
                                            <div class="modal-dialog">
                                                <div class="modal-content">
                                                    <div class="modal-header">
                                                        <h1 class="modal-title fs-5" id="exampleModalLabel">Suspend
                                                            Student Profile</h1>
                                                    </div>
                                                    <div class="modal-body">
                                                        {{ student }}
                                                    </div>
                                                    <div class="modal-footer">
                                                        <button type="button" class="btn btn-secondary"
                                                                data-bs-dismiss="modal">
                                                            Cancel
                                                        </button>
                                                        <form id="delete-topic--form-{{ student.user.id }}"
                                                              action="{% url 'dashboard:delete_profile' student.user.id %}"
                                                              method="post">
                                                            {% csrf_token %}
                                                            <input type="hidden" name="delete_confirmation"
                                                                   value="true">
                                                            <a class="btn btn-danger" href="#"
                                                               onclick="document.getElementById('delete-topic--form-{{ student.user.id }}').submit(); return false;">Delete</a>
                                                        </form>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <!-- End Delete Profile Modal -->
                                    {% endif %}
                                {% endfor %}
                                </tbody>
                            </table>
                        </div>
                        <div class="border-top py-3 px-3 d-flex align-items-center">
                            <p class="font-weight-semibold mb-0 text-dark text-sm">Page 1 of 1</p>
                            <div class="ms-auto">
                                <button class="btn btn-sm btn-white mb-0">Previous</button>
                                <button class="btn btn-sm btn-white mb-0">Next</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {#    Document List     #}
        <div class="row">
            <div class="col-12">
                <div class="card border shadow-xs mb-4">
                    <div class="card-header border-bottom pb-0">
                        <div class="d-sm-flex align-items-center">
                            <div>
                                <h6 class="font-weight-semibold text-lg mb-0">Documents list</h6>
                                <p class="text-sm">See information about all documents</p>
                            </div>
                            <div class="ms-auto d-flex">
                                <button type="button" class="btn btn-sm btn-white me-2">
                                    View all
                                </button>
                                <button type="button"
                                        class="btn btn-sm btn-dark btn-icon d-flex align-items-center me-2"
                                        data-bs-toggle="modal" data-bs-target="#exampleModal">
                          <span class="btn-inner--icon">
                              <svg width="16" height="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"
                                   fill="currentColor" class="d-block me-2">
                                  <path d="M288 109.3V352c0 17.7-14.3 32-32 32s-32-14.3-32-32V109.3l-73.4 73.4c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3l128-128c12.5-12.5 32.8-12.5 45.3 0l128 128c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L288 109.3zM64 352H192c0 35.3 28.7 64 64 64s64-28.7 64-64H448c35.3 0 64 28.7 64 64v32c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64V416c0-35.3 28.7-64 64-64zM432 456a24 24 0 1 0 0-48 24 24 0 1 0 0 48z"/></svg>
                          </span>
                                    <span class="btn-inner--text">Import File</span>
                                </button>
                            </div>
                        </div>

                    </div>
                    <div class="card-body px-0 py-0">
                        {#                        <div class="border-bottom py-3 px-3 d-sm-flex align-items-center">#}
                        {#                            <div class="btn-group" role="group" aria-label="Basic radio toggle button group">#}
                        {#                                <input type="radio" class="btn-check" name="btnradiotable" id="btnradiotable1"#}
                        {#                                       autocomplete="off" checked>#}
                        {#                                <label class="btn btn-white px-3 mb-0" for="btnradiotable1">All</label>#}
                        {#                                <input type="radio" class="btn-check" name="btnradiotable" id="btnradiotable2"#}
                        {#                                       autocomplete="off">#}
                        {#                                <label class="btn btn-white px-3 mb-0" for="btnradiotable2">Monitored</label>#}
                        {#                                <input type="radio" class="btn-check" name="btnradiotable" id="btnradiotable3"#}
                        {#                                       autocomplete="off">#}
                        {#                                <label class="btn btn-white px-3 mb-0" for="btnradiotable3">Unmonitored</label>#}
                        {#                            </div>#}
                        {#                            <div class="input-group w-sm-25 ms-auto">#}
                        {#                                            <span class="input-group-text text-body">#}
                        {#                                              <svg xmlns="http://www.w3.org/2000/svg" width="16px" height="16px"#}
                        {#                                                   fill="none" viewBox="0 0 24 24" stroke-width="1.5"#}
                        {#                                                   stroke="currentColor">#}
                        {#                                                <path stroke-linecap="round" stroke-linejoin="round"#}
                        {#                                                      d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z"></path>#}
                        {#                                              </svg>#}
                        {#                                            </span>#}
                        {#                                <input type="text" class="form-control" placeholder="Search">#}
                        {#                            </div>#}
                        {#                        </div>#}
                        {% if files %}
                            {{ files|length|json_script:"files-count" }}
                            <div class="table-responsive p-0">
                                <table class="table align-items-center mb-0">
                                    <thead class="bg-gray-100">
                                    <tr>
                                        <th class="text-secondary text-xs font-weight-semibold opacity-7">Document</th>
                                        <th class="text-secondary text-xs font-weight-semibold opacity-7 ps-2">
                                            Pages
                                        </th>
                                        <th class="text-center text-secondary text-xs font-weight-semibold opacity-7">
                                            File Type
                                        </th>
                                        <th class="text-center text-secondary text-xs font-weight-semibold opacity-7">
                                            Date
                                        </th>
                                        <th class="text-secondary opacity-7"></th>
                                        <th class="text-secondary opacity-7"></th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    {% for file in files %}
                                        <tr>
                                            <td>
                                                <div class="d-flex px-2 py-1">
                                                    <div class="d-flex align-items-center" type="button"
                                                         title="Click to expand!">
                                                        <img src="{% url 'dashboard:first_page_preview' document_id=file.id %}"
                                                             alt="First Page Preview"
                                                             class="avatar avatar-2xl me-2 fst_page">
                                                    </div>
                                                    <!-- Image viewer modal -->
                                                    <div class="modal fade" id="viewImg" tabindex="-1" role="dialog"
                                                         style="display: none;">
                                                        <div class="modal-dialog modal-lg modal-fullscreen-lg-down">
                                                            <div class="modal-content">
                                                                <div class="modal-header">
                                                                    <button type="button" class="btn-close"
                                                                            data-bs-dismiss="modal"
                                                                            aria-label="Close"></button>
                                                                </div>
                                                                <div class="modal-body">
                                                                    <div id="imgViewer" style="overflow-x: scroll;">

                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="d-flex flex-column justify-content-center ms-1">
                                                        <h6 class="mb-0 text-sm font-weight-semibold">
                                                            {{ file.id|display_value }}
                                                        </h6>
                                                        <p class="text-sm text-secondary mb-0">
                                                            by {{ file.user.user.username }}</p>
                                                    </div>
                                                </div>
                                            </td>
                                            <td>
                                                <span class="text-secondary text-sm font-weight-normal">{{ file.id|nb_pages }}</span>
                                            </td>
                                            <td class="align-middle text-center text-sm">
                                                <span class="text-secondary text-sm font-weight-normal">{{ file.file_field.name|file_extension|cut:"."|upper }}</span>
                                            </td>
                                            <td class="align-middle text-center">
                                                <span class="text-secondary text-sm font-weight-normal">{{ file.upload_date|date:"F j, Y" }}</span>
                                            </td>
                                            <td class="align-middle text-center">
                                                <a type="button" {% if file.average_rating > 0 %}
                                                   title="See Document Reviews" data-bs-toggle="modal"
                                                   data-bs-target="#reviewModal-{{ file.id }}"{% else %}
                                                   title="No Reviews Yet" {% endif %}
                                                   class="text-sm link-underline-warning text-warning opacity-75"
                                                >
                                                    {{ file.average_rating }}
                                                    <i class="fa fa-solid fa-star"></i>
                                                </a>
                                            </td>
                                            <td class="align-middle">
                                                <div class="d-flex align-items-center actions">
                                            <span data-bs-toggle="modal" data-bs-target="#info-{{ forloop.counter }}">
                                                <i title="Info" class="fa fa-solid fa-info text-success"></i>
                                            </span>
                                                    <div class="dot-separator mx-2">
                                                    </div>
                                                    <span data-bs-toggle="modal"
                                                          data-bs-target="#file-{{ forloop.counter }}">
                                                      <i title="View" class="fa fa-solid fa-eye text-primary"></i>
                                            </span>
                                                    <div class="dot-separator mx-2"></div>
                                                    <span data-bs-toggle="modal"
                                                          data-bs-target="#delete-{{ forloop.counter }}">
                                                <i title="Delete" class="fa fa-solid fa-trash text-danger"></i>
                                            </span>
                                                </div>
                                            </td>
                                        </tr>
                                        <!-- Review Modal -->
                                        <div class="modal fade" id="reviewModal-{{ file.id }}" tabindex="-2"
                                             role="dialog"
                                             aria-labelledby="reviewModalLabel" aria-hidden="true">
                                            <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
                                                <div class="modal-content">
                                                    <div class="modal-header">
                                                        <h5 class="modal-title" id="reviewModalLabel">Reviews <small>({{ file.id|display_value }})</small></h5>
                                                        <button type="button" class="btn-close"
                                                                data-bs-dismiss="modal"
                                                                aria-label="Close"></button>
                                                    </div>
                                                    <div class="modal-body">

                                                        <div class="row  d-flex justify-content-center mx-2">
                                                            {% for review in file.id|document_reviews %}
                                                                <div class="card p-3">

                                                                    <div class="d-flex justify-content-between align-items-center">

                                                                        <div class="user d-flex flex-row align-items-center">
                                                                        <span>
                                                                            <small class="font-weight-bold text-primary ms-2 me-1">{{ review.student }}:</small>
                                                                            <small class="font-weight-bold">{{ review.description }}</small>
                                                                        </span>
                                                                        </div>
                                                                        <small>{{ review.created_at|days_ago }}</small>

                                                                    </div>


                                                                    <div class="action d-flex justify-content-between mt-2 align-items-center">

                                                                        <div class="reply px-4">
                                                                            <form id="delete-review-form-{{ review.id }}"
                                                                                  action="{% url 'dashboard:delete_review' review.id %}"
                                                                                  method="post">
                                                                                {% csrf_token %}
                                                                                <input type="hidden"
                                                                                       name="delete_confirmation"
                                                                                       value="true">
                                                                                <a class="link-underline-danger text-danger"
                                                                                   href="#"
                                                                                   onclick="document.getElementById('delete-review-form-{{ review.id }}').submit(); return false;"><small>Remove</small></a>
                                                                            </form>
                                                                        </div>

                                                                        <div class="icons align-items-center text-warning">
                                                                            {{ review.rating }}
                                                                            <i class="fa fa-star"></i>
                                                                        </div>
                                                                    </div>


                                                                </div>
                                                            {% endfor %}
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <!-- End Review Modal -->
                                        <!-- View Modal -->
                                        <div class="modal fade" id="file-{{ forloop.counter }}"
                                             data-bs-backdrop="static"
                                             data-bs-keyboard="false"
                                             tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
                                            <div class="modal-dialog modal-dialog-centered modal-xl">
                                                <div class="modal-content">
                                                    <div class="modal-header">
                                                        <h1 class="modal-title fs-5"
                                                            id="staticBackdropLabel">{{ file.id|display_value }}</h1>
                                                        <span class="ms-2">
                                              <a href="{% url 'dashboard:download_file' file.id %}">
                                                <i title="Download"
                                                   class="fa fa-solid fa-download text-success fs-4"></i>
                                              </a>
                                            </span>
                                                        <button type="button" class="btn-close"
                                                                data-bs-dismiss="modal"
                                                                aria-label="Close"></button>
                                                    </div>
                                                    <div class="modal-body">
                                                        <iframe src="/media/{{ file.file_field.name }}" width="100%"
                                                                height="700px"></iframe>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <!-- Delete Document Modal -->
                                        <div class="modal fade" id="delete-{{ forloop.counter }}" tabindex="-1"
                                             aria-labelledby="exampleModalLabel" aria-hidden="true">
                                            <div class="modal-dialog">
                                                <div class="modal-content">
                                                    <div class="modal-header">
                                                        <h1 class="modal-title fs-5" id="exampleModalLabel">Delete
                                                            File</h1>
                                                    </div>
                                                    <div class="modal-body">
                                                        {{ file.id|display_value }}
                                                    </div>
                                                    <div class="modal-footer">
                                                        <button type="button" class="btn btn-secondary"
                                                                data-bs-dismiss="modal">
                                                            Cancel
                                                        </button>
                                                        <form id="delete-form-{{ forloop.counter }}"
                                                              action="{% url 'dashboard:delete_file' file.id %}"
                                                              method="post">
                                                            {% csrf_token %}
                                                            <input type="hidden" name="delete_confirmation"
                                                                   value="true">
                                                            <a class="btn btn-danger" href="#"
                                                               onclick="document.getElementById('delete-form-{{ forloop.counter }}').submit(); return false;">Delete</a>
                                                        </form>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <!-- Info Modal -->
                                        <div class="modal fade" id="info-{{ forloop.counter }}" tabindex="-1"
                                             aria-labelledby="exampleModalLabel" aria-hidden="true">
                                            <div class="modal-dialog">
                                                <div class="modal-content">
                                                    <div class="modal-header">
                                                        <h1 class="modal-title fs-5" id="exampleModalLabel">File
                                                            Info</h1>
                                                        <button type="button" class="btn-close"
                                                                data-bs-dismiss="modal"
                                                                aria-label="Close"></button>
                                                    </div>
                                                    <div class="modal-body">
                                                        <form action="{% url 'dashboard:save_info' file.id %}"
                                                              method="post">
                                                            {% csrf_token %}
                                                            <div class="form-group mb-2">
                                                                <label for="" class="form-label">Title</label>
                                                                <input type="text" value="{{ file.id|display_value }}"
                                                                       name="title"
                                                                       class="form-control">
                                                            </div>
                                                            <div class="form-group mb-2">
                                                                <label class="form-label" for="doctype">Course</label>
                                                                <select class="form-select font-weight-light font-italic text-sm"
                                                                        id="course"
                                                                        name="course" required>
                                                                    {% for topic in topics %}
                                                                        <option value={{ topic.id }} {% if topic.id == file.id|course_value %}selected{% endif %}>{{ topic.name }}</option>
                                                                    {% endfor %}
                                                                </select>
                                                            </div>
                                                            <div class="form-group mb-2">
                                                                <label class="form-label" for="doctype">Document
                                                                    Type</label>
                                                                <select class="form-select font-weight-light font-italic text-sm"
                                                                        id="doctype"
                                                                        name="doctype" required>
                                                                    <option selected>Select Document Type..</option>
                                                                    {% for doctype in doctypes %}
                                                                        <option value={{ doctype.id }} {% if doctype.id == file.id|doctype_value %}selected{% endif %}>{{ doctype.name }}</option>
                                                                    {% endfor %}
                                                                </select>
                                                            </div>
                                                            <div class="form-group mb-2">
                                                                <label class="form-label" for="uni">School</label>
                                                                <select class="form-select font-weight-light font-italic text-sm"
                                                                        id="uni" name="uni"
                                                                        required>
                                                                    <option selected>Select the School Document belongs
                                                                        to..
                                                                    </option>
                                                                    {% for school in schools %}
                                                                        <option value={{ school.id }} {% if school.id == file.id|uni_value %}selected{% endif %}>{{ school.name }}</option>
                                                                    {% endfor %}
                                                                </select>
                                                            </div>
                                                            <div class="form-group mb-2">
                                                                <label for="info" class="form-label">Description</label>
                                                                <textarea
                                                                        name="info" id="info"
                                                                        class="form-control fw-lighter text-sm fst-italic"
                                                                        rows="3" minlength="20"
                                                                        required>{{ file.info }}</textarea>
                                                            </div>
                                                            <div class="d-flex justify-content-end">
                                                                <button type="submit" class="btn btn-primary"
                                                                >Save
                                                                </button>
                                                            </div>
                                                        </form>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                            <div class="border-top py-3 px-3 d-flex align-items-center">
                                <p class="font-weight-semibold mb-0 text-dark text-sm">Page 1 of 1</p>
                                <div class="ms-auto">
                                    <button class="btn btn-sm btn-white mb-0">Previous</button>
                                    <button class="btn btn-sm btn-white mb-0">Next</button>
                                </div>
                            </div>
                        {% else %}
                            <div class="border-top py-3 px-3 d-flex align-items-center justify-content-center">
                                <p class="font-weight-semibold mb-3 mt-3 text-dark text-lg">No files Found</p>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-lg-6">
                <div class="card shadow-xs border mb-4">
                    <div class="card-header border-bottom pb-0">
                        <div class="d-sm-flex align-items-center">
                            <div>
                                <h6 class="font-weight-semibold text-lg mb-0">Schools list</h6>
                                <p class="text-sm">See information about all schools</p>
                            </div>
                            <div class="ms-auto d-flex">
                                <button type="button" class="btn btn-sm btn-white me-2">
                                    View all
                                </button>
                                <button type="button"
                                        class="btn btn-sm btn-dark btn-icon d-flex align-items-center me-2"
                                        data-bs-toggle="modal" data-bs-target="#addSchoolModal">
                                    <i class="fa fa-solid fa-school fs-6"></i>
                                    <span class="ms-1 btn-inner--text">Add School</span>
                                </button>
                            </div>
                        </div>

                    </div>
                    <div class="card-body py-0">
                        <div class="table-responsive p-0 mt-1">
                            <table class="table mb-0">
                                <thead class="bg-gray-100">
                                <tr>
                                    <th class="text-secondary text-xs font-weight-semibold opacity-7">
                                        Schools
                                    </th>
                                    <th class="text-secondary opacity-7"></th>
                                </tr>
                                </thead>
                                <tbody>
                                {% for school in schools %}
                                    <tr>
                                        <td class="d-flex align-items-center py-3 px-4 text-xs">
                                            <span class="font-weight-semibold text-dark">{{ school.name }}</span>
                                        </td>

                                        <td>
                                            <span type="button" data-bs-toggle="modal"
                                                  data-bs-target="#delete-school-{{ school.id }}">
                                                <i title="Delete School" class="fa fa-solid fa-trash"
                                                   style="color:#64748B"></i> </span>
                                        </td>
                                    </tr>
                                    <!-- Delete School Modal -->
                                    <div class="modal fade" id="delete-school-{{ school.id }}" tabindex="-1"
                                         aria-labelledby="exampleModalLabel" aria-hidden="true">
                                        <div class="modal-dialog">
                                            <div class="modal-content">
                                                <div class="modal-header">
                                                    <h1 class="modal-title fs-5" id="exampleModalLabel">Delete
                                                        School</h1>
                                                </div>
                                                <div class="modal-body">
                                                    {{ school }}
                                                </div>
                                                <div class="modal-footer">
                                                    <button type="button" class="btn btn-secondary"
                                                            data-bs-dismiss="modal">
                                                        Cancel
                                                    </button>
                                                    <form id="delete-school-form-{{ school.id }}"
                                                          action="{% url 'dashboard:delete_school' school.id %}"
                                                          method="post">
                                                        {% csrf_token %}
                                                        <input type="hidden" name="delete_confirmation"
                                                               value="true">
                                                        <a class="btn btn-danger" href="#"
                                                           onclick="document.getElementById('delete-school-form-{{ school.id }}').submit(); return false;">Delete</a>
                                                    </form>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- End Delete School Modal -->
                                {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>

                </div>
            </div>
            {#Topics#}
            <div class="col-lg-6">
                <div class="card shadow-xs border mb-4">
                    <div class="card-header border-bottom pb-0">
                        <div class="d-sm-flex align-items-center">
                            <div>
                                <h6 class="font-weight-semibold text-lg mb-0">Subjects list</h6>
                                <p class="text-sm">See information about all subjects</p>
                            </div>
                            <div class="ms-auto d-flex">
                                <button type="button" class="btn btn-sm btn-white me-2">
                                    View all
                                </button>
                                <button type="button"
                                        class="btn btn-sm btn-dark btn-icon d-flex align-items-center me-2"
                                        data-bs-toggle="modal" data-bs-target="#addSubjectModal">
                                    <i class="fa fa-solid fa-book fs-6"></i>
                                    <span class="ms-1 btn-inner--text">Add Subject</span>
                                </button>
                            </div>
                        </div>

                    </div>
                    <div class="card-body py-0">
                        <div class="table-responsive p-0 mt-1">
                            <table class="table align-items-center mb-0">
                                <thead class="bg-gray-100">
                                <tr>
                                    <th class="text-secondary text-xs font-weight-semibold opacity-7">
                                        Subjects
                                    </th>
                                    <th class="text-secondary opacity-7"></th>
                                </tr>
                                </thead>
                                <tbody>
                                {% for subject in topics %}
                                    <tr>
                                        <td class="d-flex align-items-center py-3 px-4 text-xs">
                                            <span class="font-weight-semibold text-dark">{{ subject.name }}</span>
                                        </td>
                                        <td>
                                            <span data-bs-toggle="modal"
                                                  data-bs-target="#update-subject-{{ subject.id }}" type="button">
                                                <i title="Update Subject" class="fa fa-solid fa-pen"
                                                   style="color:#64748B"></i>
                                            </span>
                                        </td>
                                        <td>
                                            <span type="button" data-bs-toggle="modal"
                                                  data-bs-target="#delete-topic-{{ subject.id }}">
                                                <i title="Delete Document Type" class="fa fa-solid fa-trash"
                                                   style="color:#64748B"></i> </span>
                                        </td>
                                    </tr>
                                    <!-- Delete Subject Modal -->
                                    <div class="modal fade" id="delete-topic-{{ subject.id }}" tabindex="-1"
                                         aria-labelledby="exampleModalLabel" aria-hidden="true">
                                        <div class="modal-dialog">
                                            <div class="modal-content">
                                                <div class="modal-header">
                                                    <h1 class="modal-title fs-5" id="exampleModalLabel">Delete
                                                        Document Type</h1>
                                                </div>
                                                <div class="modal-body">
                                                    {{ subject }}
                                                </div>
                                                <div class="modal-footer">
                                                    <button type="button" class="btn btn-secondary"
                                                            data-bs-dismiss="modal">
                                                        Cancel
                                                    </button>
                                                    <form id="delete-topic--form-{{ subject.id }}"
                                                          action="{% url 'dashboard:delete_subject' subject.id %}"
                                                          method="post">
                                                        {% csrf_token %}
                                                        <input type="hidden" name="delete_confirmation"
                                                               value="true">
                                                        <a class="btn btn-danger" href="#"
                                                           onclick="document.getElementById('delete-topic--form-{{ subject.id }}').submit(); return false;">Delete</a>
                                                    </form>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- End Delete Subject Modal -->
                                    <!-- Update Subject Modal -->
                                    <div class="modal fade" id="update-subject-{{ subject.id }}" tabindex="-1"
                                         aria-labelledby="exampleModalLabel" aria-hidden="true">
                                        <div class="modal-dialog">
                                            <div class="modal-content">
                                                <div class="modal-header">
                                                    <h1 class="modal-title fs-5" id="exampleModalLabel">
                                                        Update {{ subject.name }}</h1>

                                                    <button type="button" class="btn-close" data-bs-dismiss="modal"
                                                            aria-label="Close"></button>
                                                </div>
                                                <div class="modal-body">
                                                    <form action="{% url 'dashboard:update_subject' subject.id %}"
                                                          method="post">
                                                        {% csrf_token %}
                                                        <div class="form-group mb-2">
                                                            <label for="" class="form-label">Title</label>
                                                            <input type="text" value="{{ subject.name }}"
                                                                   name="subject_name"
                                                                   class="form-control">
                                                        </div>
                                                        <div class="form-group mb-2">
                                                            <label for="subject_coeff" class="form-label">Subject
                                                                Persistence
                                                                Coefficient</label>
                                                            <input type="number" id="subject_coeff" name="subject_coeff"
                                                                   class="form-control fw-lighter text-sm fst-italic"
                                                                   value="{{ subject.coef }}"
                                                                   min="0.1" max="1.0" step="0.1" required>
                                                        </div>
                                                        <div class="d-flex justify-content-end">
                                                            <button type="submit" class="btn btn-primary">Save
                                                            </button>
                                                        </div>
                                                    </form>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- End Update Subject Modal -->
                                {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            {#Doctype#}
            <div class="col-lg-6">
                <div class="card shadow-xs border mb-4">
                    <div class="card-header border-bottom pb-0">
                        <div class="d-sm-flex align-items-center">
                            <div>
                                <h6 class="font-weight-semibold text-lg mb-0">Document Types list</h6>
                                <p class="text-sm">See information about all Document Types</p>
                            </div>
                            <div class="ms-auto d-flex">
                                <button type="button"
                                        class="btn btn-sm btn-dark btn-icon d-flex align-items-center me-2"
                                        data-bs-toggle="modal" data-bs-target="#addDocTypeModal">
                                    <i class="fa fa-solid fa-folder fs-6"></i>
                                    <span class="ms-1 btn-inner--text">Add Document Type</span>
                                </button>
                            </div>
                        </div>

                    </div>
                    <div class="card-body py-0">
                        <div class="table-responsive p-0 mt-1">
                            <table class="table align-items-center mb-0">
                                <thead class="bg-gray-100">
                                <tr>
                                    <th class="text-secondary text-xs font-weight-semibold opacity-7">
                                        Document Types
                                    </th>
                                    <th class="text-secondary opacity-7"></th>
                                </tr>
                                </thead>
                                <tbody>
                                {% for doct in doctypes %}
                                    <tr>
                                        <td class="d-flex align-items-center py-3 px-4 text-xs">
                                            <span class="font-weight-semibold text-dark">{{ doct.name }}</span>
                                        </td>
                                        <td>
                                            <span type="button" data-bs-toggle="modal"
                                                  data-bs-target="#delete-doct-{{ doct.id }}">
                                                <i title="Delete Document Type" class="fa fa-solid fa-trash"
                                                   style="color:#64748B"></i> </span>
                                        </td>
                                    </tr>
                                    <!-- Delete Document Type Modal -->
                                    <div class="modal fade" id="delete-doct-{{ doct.id }}" tabindex="-1"
                                         aria-labelledby="exampleModalLabel" aria-hidden="true">
                                        <div class="modal-dialog">
                                            <div class="modal-content">
                                                <div class="modal-header">
                                                    <h1 class="modal-title fs-5" id="exampleModalLabel">Delete
                                                        Document Type</h1>
                                                </div>
                                                <div class="modal-body">
                                                    {{ doct }}
                                                </div>
                                                <div class="modal-footer">
                                                    <button type="button" class="btn btn-secondary"
                                                            data-bs-dismiss="modal">
                                                        Cancel
                                                    </button>
                                                    <form id="delete-doct-form-{{ doct.id }}"
                                                          action="{% url 'dashboard:delete_doct' doct.id %}"
                                                          method="post">
                                                        {% csrf_token %}
                                                        <input type="hidden" name="delete_confirmation"
                                                               value="true">
                                                        <a class="btn btn-danger" href="#"
                                                           onclick="document.getElementById('delete-doct-form-{{ doct.id }}').submit(); return false;">Delete</a>
                                                    </form>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- End Delete Document Type Modal -->
                                {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="container-fluid py-4 px-5">
        <div class="row">
            <div class="col-12">
                <div class="card border shadow-xs mb-4">
                    <div class="card-header border-bottom pb-0">
                        <div class="d-sm-flex align-items-center mb-3">
                            <div>
                                <h6 class="font-weight-semibold text-lg mb-0">Recent transactions</h6>
                                <p class="text-sm mb-sm-0">These are details about the last transactions</p>
                            </div>
                        </div>
                    </div>
                    <div class="card-body px-0 py-0">
                        <div class="table-responsive p-0">
                            <table class="table align-items-center justify-content-center mb-0">
                                <thead class="bg-gray-100">
                                <tr>
                                    <th class="text-secondary text-xs font-weight-semibold opacity-7">Transaction</th>
                                    <th class="text-secondary text-xs font-weight-semibold opacity-7 ps-2 align-center">
                                        Type
                                    </th>
                                    <th class="text-secondary text-xs font-weight-semibold opacity-7 ps-2">Student</th>
                                    <th class="text-secondary text-xs font-weight-semibold opacity-7 ps-2">Document</th>
                                    <th class="text-secondary text-xs font-weight-semibold opacity-7 ps-2">Amount</th>
                                </tr>
                                </thead>
                                <tbody>
                                {% for transaction in transactions %}
                                    <tr>
                                        <td class="d-flex align-items-center py-3 px-4 text-sm">
                                            <span class="font-weight-semibold text-dark ms-1">{{ transaction.transaction_date }}</span>
                                        </td>
                                        <td>
                                        <span class="align-center badge badge-sm border
                                             border-primary text-dark bg-primary
                                        border-radius-sm">
                                          {{ transaction.transaction_type }}
                                        </span>
                                        </td>
                                        <td>
                                            <span class="text-sm">{{ transaction.user }}</span>
                                        </td>
                                        <td>
                                            <span class="text-sm">{{ transaction.document.id|display_value }}</span>
                                        </td>
                                        <td>
                                            {% if transaction.transaction_type == 'upload' %}

                                                <span class="badge rounded-pill bg-info text-dark">
                                                +
                                                {{ transaction.amount }}
                                                </span>
                                            {% else %}
                                                <span class="badge rounded-pill bg-info text-dark">
                                                -
                                                {{ transaction.amount }}
                                                </span>
                                            {% endif %}
                                        </td>
                                    </tr>
                                {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% include 'dashboard/includes/footer.html' %}
    </div>
    <!-- Add School Modal -->
    <div class="modal fade" id="addSchoolModal" tabindex="-1" aria-labelledby="addSchoolModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-fullscreen-lg-down">
            <form method="post" action="{% url 'dashboard:add_school' %}" id="add-school"
                  enctype="multipart/form-data" class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addSchoolModalLabel">Add School</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">

                    {% csrf_token %}
                    <div class="form-group mb-2">
                        <label for="" class="form-label">School Name</label>
                        <input type="text"
                               name="school_name"
                               class="form-control fw-lighter text-sm fst-italic" placeholder="Enter School Name.."
                               required>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-primary">Add</button>
                </div>
            </form>
        </div>
    </div>
    <!-- End Add School Modal -->

    <!-- Add DocType Modal -->
    <div class="modal fade" id="addDocTypeModal" tabindex="-1" aria-labelledby="addDocTypeModalLabel"
         aria-hidden="true">
        <div class="modal-dialog modal-lg modal-fullscreen-lg-down">
            <form method="post" action="{% url 'dashboard:add_doct' %}" id="add-doct"
                  enctype="multipart/form-data" class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addDocTypeModalLabel">Add Document Type</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">

                    {% csrf_token %}
                    <div class="form-group mb-2">
                        <label for="" class="form-label">Document Type</label>
                        <input type="text"
                               name="doct_name"
                               class="form-control fw-lighter text-sm fst-italic" placeholder="Enter Document Type.."
                               required>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-primary">Add</button>
                </div>
            </form>
        </div>
    </div>
    <!-- End Add DocType Modal -->

    <!-- Add Subject Modal -->
    <div class="modal fade" id="addSubjectModal" tabindex="-1" aria-labelledby="addSubjectModalLabel"
         aria-hidden="true">
        <div class="modal-dialog modal-lg modal-fullscreen-lg-down">
            <form method="post" action="{% url 'dashboard:add_subject' %}" id="add-subject"
                  enctype="multipart/form-data" class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addSubjectModalLabel">Add Subject</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">

                    {% csrf_token %}
                    <div class="form-group mb-2">
                        <label for="subject_name" class="form-label">Subject Name</label>
                        <input type="text"
                               name="subject_name"
                               class="form-control fw-lighter text-sm fst-italic" placeholder="Enter Subject Name.."
                               required>
                    </div>
                    <div class="form-group mb-2">
                        <label for="coeff" class="form-label">Subject Persistency Coefficient</label>
                        <input type="number" id="coeff" name="coeff" class="form-control fw-lighter text-sm fst-italic"
                               placeholder="Select coefficient from 0.1 to 1.."
                               min="0.1" max="1.0" step="0.1" required>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-primary">Add</button>
                </div>
            </form>
        </div>
    </div>
    <!-- End Add Subject Modal -->
    <!-- File Upload Modal -->
    <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-fullscreen-lg-down">
            <form method="post" action="{% url 'dashboard:upload_file' %}" id="upload-file"
                  enctype="multipart/form-data" class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Import Your File</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">

                    {% csrf_token %}
                    <div class="file-loading">
                        <input id="input-b6b" name="file" type="file">
                    </div>
                    <div id="kartik-file-errors"></div>
                    <div class="form-group mb-2">
                        <label for="" class="form-label">Title</label>
                        <input type="text"
                               name="title"
                               class="form-control fw-lighter text-sm fst-italic" placeholder="Enter Document Title.."
                               required>
                    </div>
                    <div class="form-group mb-2">
                        <label class="form-label" for="doctype">Course</label>
                        <select class="form-select font-weight-light font-italic text-sm" id="course"
                                name="course" required>
                            <option selected>Select Course..</option>
                            {% for topic in topics %}
                                <option value={{ topic.id }}>{{ topic.name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="form-group mb-2">
                        <label class="form-label" for="doctype">Document Type</label>
                        <select class="form-select font-weight-light font-italic text-sm" id="doctype"
                                name="doctype" required>
                            <option selected>Select Document Type..</option>
                            {% for doctype in doctypes %}
                                <option value={{ doctype.id }}>{{ doctype.name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="form-group mb-2">
                        <label class="form-label" for="uni">School</label>
                        <select class="form-select font-weight-light font-italic text-sm" id="uni" name="uni"
                                required>
                            <option selected>Select the School Document belongs to..</option>
                            {% for school in schools %}
                                <option value={{ school.id }}>{{ school.name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="form-group mb-2">
                        <label for="" class="form-label">Description</label>
                        <textarea
                                name="info" id="" class="form-control fw-lighter text-sm fst-italic" rows="3"
                                minlength="20" placeholder="Enter Document Description.." required></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-primary">Import</button>
                </div>
            </form>
        </div>
    </div>
    <!-- End File Upload Modal -->



{% endblock content %}
{% block extrascripts %}

    <script>
        document.addEventListener('keydown', (event) => {
            if (event.key === 'Escape' || event.key === 'Esc' || event.key === 27) {
                let files = document.getElementById('files-count').textContent;
                for (let i = 1; i <= files; i++) {
                    let closeButtonElements = document.getElementById(`modal-close-btn-${i}`);
                    closeButtonElements.click();
                }
            }
        })
        $(document).ready(function () {
            $("#input-b6b").fileinput({
                showUpload: false,
                dropZoneEnabled: false,
                elErrorContainer: '#kartik-file-errors',
                allowedFileExtensions: ["pdf"],
                inputGroupClass: "input-group-sm"
            });
        });
        $('.fst_page').on('click', function (e) {
            $('#imgViewer').html('').append($(e.currentTarget).clone().removeClass('avatar').removeClass('avatar-2xl'))
            $('#viewImg').modal('show')
        })

        $('.fst_page').each(function (i, e) {
            $(e).wrap('<div class="img-wrapper"></div>')
        })
        // Function to collapse the modal
        $('.close').on('click', function () {
            $('#viewImg').modal('hide');
        });
    </script>
{% endblock extrascripts %}